<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- The page title will update dynamically -->
  <title id="pageTitle">Quiz for CSS Aspirents</title>
  <style>
    /* Overall styling */
    body {
      background: linear-gradient(135deg, #f0f9ff, #e0f7fa);
      color: #333;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      user-select: none;
    }
    /* Header styling */
    .header {
      background: linear-gradient(135deg, #ff4081, #ff80ab);
      color: #fff;
      text-align: center;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .header h1 {
      margin: 0;
      font-size: 36px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .header p, #currentDate {
      margin: 5px 0;
      font-size: 16px;
    }
    /* Footer styling */
    .footer {
      background: linear-gradient(135deg, #8e24aa, #d81b60);
      color: #fff;
      text-align: center;
      padding: 12px;
      margin-top: 20px;
      font-size: 14px;
    }
    /* Container for main content */
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 10px;
    }
    /* Sections for login, quiz and results */
    #loginSection, #quizSection, #results {
      margin: 20px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    /* Initially, only login is visible */
    #quizSection, #results { display: none; }
    /* Timer styling */
    #timer {
      text-align: right;
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
    }
    /* Table styling for default quiz mode */
    .quiz-table {
      width: 100%;
      border-collapse: collapse;
    }
    .quiz-table th, .quiz-table td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
      font-size: 14px;
    }
    .quiz-table th {
      background-color: #002244;
      color: #ffffff;
    }
    /* Button styling */
    button {
      cursor: pointer;
      background: #1e88e5;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 4px;
      transition: background 0.3s ease;
      font-size: 16px;
    }
    button:hover { background: #1565c0; }
    input, select {
      margin: 8px 0;
      padding: 10px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    .error { color: red; font-size: 14px; }
    /* For responsive table */
    .table-container { overflow-x: auto; }
    /* Admin panel styling */
    .admin-panel-section {
      background: #fafafa;
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 4px;
    }
  </style>
</head>
<body oncontextmenu="return false;">
  <!-- Header -->
  <div class="header" id="headerSection">
    <h1 id="headerTitle">QUIZ FOR CSS ASPIRENTS BY SYED ASGHAR ALI SHAH</h1>
    <p id="headerSubtitle">Contact: 03265762698</p>
    <p id="currentDate"></p>
  </div>
  
  <!-- Main container -->
  <div class="container">
    <!-- Login Section -->
    <div id="loginSection">
      <h2>Login</h2>
      <input id="loginUser" placeholder="Username">
      <input id="loginPass" type="password" placeholder="Password">
      <button id="loginBtn">Login</button>
      <p id="loginError" class="error"></p>
    </div>

    <!-- Quiz Section -->
    <div id="quizSection">
      <div id="timer">Time Remaining: 25:00</div>
      <div id="quizContainer"></div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer" id="footerSection">
    <p id="footerText"></p>
  </div>

  <script>
    /* ==================== Utility Functions ==================== */
    function updateCurrentDate() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById("currentDate").textContent = now.toLocaleDateString(undefined, options);
    }
    updateCurrentDate();

    document.onkeydown = e => {
      if (e.keyCode === 123 ||
         (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
         (e.ctrlKey && e.keyCode === 85)) {
        return false;
      }
    };

    function loadHeaderFooter() {
      const headerTitle = localStorage.getItem("headerTitle") || "QUIZ FOR CSS ASPIRENTS BY SYED ASGHAR ALI SHAH";
      const headerSubtitle = localStorage.getItem("headerSubtitle") || "Contact: 03265762698";
      const footerText = localStorage.getItem("footerText") || "";
      document.getElementById("headerTitle").textContent = headerTitle;
      document.getElementById("headerSubtitle").textContent = headerSubtitle;
      document.getElementById("footerText").textContent = footerText;
      document.getElementById("pageTitle").textContent = headerTitle;
    }
    loadHeaderFooter();

    function getUsers() { return JSON.parse(localStorage.getItem("users") || "[]"); }
    function saveUsers(users) { localStorage.setItem("users", JSON.stringify(users)); }
    if (!getUsers().length) {
      saveUsers([{ u: "testUser", p: "test123", mode: "single", added: Date.now() }]);
    }
    function getResults() { return JSON.parse(localStorage.getItem("quizResults") || "[]"); }
    function saveResults(results) { localStorage.setItem("quizResults", JSON.stringify(results)); }

    /* ==================== State Variables ==================== */
    let currentUser = "";
    let quizStart = 0, timerId;
    const QUIZ_DURATION = 25 * 60; // 25 minutes in seconds

    // Default quiz data (used only if no uploaded HTML exists)
    const quizData = [
      { question:"Which of the following is an example of a compound sentence?",
        options: [
          "The government passed the bill, and the opposition applauded.",
          "When the government passed the bill, the opposition applauded.",
          "The government passed the bill because the opposition applauded.",
          "Although the government passed the bill, the opposition applauded."
        ],
        correct: 0 },
      { question:"Identify the subordinate clause in the sentence: 'Before debating these issues, several questions arise.'",
        options: [
          "several questions arise",
          "Before debating these issues",
          "debating these issues",
          "questions arise"
        ],
        correct: 1 },
      // ... add more questions up to 50 as needed
    ];
    while(quizData.length < 50) quizData.push(...quizData.slice(0, 50 - quizData.length));
    quizData.forEach(q => { q.options.sort(() => Math.random() - 0.5); });

    /* ==================== Login & Quiz Start ==================== */
    document.getElementById("loginBtn").onclick = () => {
      const u = document.getElementById("loginUser").value.trim();
      const p = document.getElementById("loginPass").value.trim();
      const err = document.getElementById("loginError");
      err.textContent = "";
      if (!u || !p) { err.textContent = "Enter both fields."; return; }
      // Admin login check
      if (u === "SYED ASGHAR ALI SHAH" && p === "IHTI795358") {
        document.getElementById("loginSection").style.display = "none";
        loadAdminPanel();
        return;
      }
      // Validate user
      const usr = getUsers().find(x => x.u === u && x.p === p);
      if (!usr) { err.textContent = "Invalid credentials."; return; }
      // Successful login â€“ set current user and start quiz immediately.
      currentUser = u;
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("quizSection").style.display = "block";
      renderQuiz();
      quizStart = Date.now();
      startTimer();
    };

    // For consistency (even though no locking is applied)
    function getDeviceId() {
      let id = localStorage.getItem("deviceId");
      if (!id) {
        id = Math.random().toString(36).slice(2);
        localStorage.setItem("deviceId", id);
      }
      return id;
    }

    /* ==================== Quiz Rendering ==================== */
    function renderQuiz() {
      const container = document.getElementById("quizContainer");
      // If an uploaded quiz HTML file exists, render it via an iframe.
      const uploadedQuiz = localStorage.getItem("uploadedQuizHTML");
      if (uploadedQuiz) {
        if (currentUser !== "SYED ASGHAR ALI SHAH") {
          document.getElementById("headerSection").style.display = "none";
          document.getElementById("footerSection").style.display = "none";
          document.getElementById("loginSection").style.display = "none";
        }
        document.getElementById("quizSection").style.margin = "0";
        container.innerHTML = "";
        const iframe = document.createElement("iframe");
        iframe.style.position = "fixed";
        iframe.style.top = "0";
        iframe.style.left = "0";
        iframe.style.width = "100%";
        iframe.style.height = "100%";
        iframe.style.border = "none";
        iframe.srcdoc = uploadedQuiz;
        container.appendChild(iframe);
        return;
      }
      // Otherwise, render default quiz interface (table-based)
      container.innerHTML = "";
      const tableContainer = document.createElement("div");
      tableContainer.className = "table-container";
      const table = document.createElement("table");
      table.className = "quiz-table";
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>#</th>
          <th>Question</th>
          <th>Options</th>
        </tr>
      `;
      table.appendChild(thead);
      const tbody = document.createElement("tbody");
      quizData.forEach((q, index) => {
        const tr = document.createElement("tr");
        const numCell = document.createElement("td");
        numCell.textContent = index + 1;
        const questionCell = document.createElement("td");
        questionCell.textContent = q.question;
        const optionsCell = document.createElement("td");
        q.options.forEach(opt => {
          const label = document.createElement("label");
          label.style.display = "block";
          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = "question" + index;
          radio.value = opt;
          label.appendChild(radio);
          label.appendChild(document.createTextNode(" " + opt));
          optionsCell.appendChild(label);
        });
        tr.appendChild(numCell);
        tr.appendChild(questionCell);
        tr.appendChild(optionsCell);
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      tableContainer.appendChild(table);
      container.appendChild(tableContainer);
    }

    /* ==================== Timer Functions ==================== */
    function startTimer() {
      const endTime = quizStart + QUIZ_DURATION * 1000;
      timerId = setInterval(() => {
        const now = Date.now();
        const diff = Math.max(0, Math.floor((endTime - now) / 1000));
        const mins = String(Math.floor(diff / 60)).padStart(2, '0');
        const secs = String(diff % 60).padStart(2, '0');
        document.getElementById("timer").textContent = `Time Remaining: ${mins}:${secs}`;
        if (diff <= 0) { clearInterval(timerId); submitQuiz(); }
      }, 1000);
    }

    /* ==================== Submission & Results ==================== */
    function submitQuiz() {
      // Implementation for submitting quiz answers
    }

    /* ==================== ADMIN PANEL ==================== */
    function loadAdminPanel() {
      const adminContainer = document.createElement("div");
      adminContainer.id = "adminPanel";
      adminContainer.style.padding = "20px";
      adminContainer.style.background = "#fff";
      adminContainer.innerHTML = `
        <h2>Admin Panel</h2>
        <!-- Credential Management -->
        <div class="admin-panel-section">
          <h3>Manage User Credentials</h3>
          <table>
            <thead>
              <tr>
                <th>Username</th>
                <th>Password</th>
                <th>Mode</th>
                <th>Added On</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="userTable"></tbody>
          </table>
          <h4>Add New User</h4>
          <input id="newUser" placeholder="Username">
          <input id="newPass" type="password" placeholder="Password">
          <select id="newMode">
            <option value="single">Singleâ€‘Device</option>
            <option value="multi">Multiâ€‘Device</option>
          </select>
          <button id="addUserBtn">Add User</button>
        </div>

        <!-- Header/Footer & Quiz Scheduling -->
        <div class="admin-panel-section">
          <h3>Customize Header & Footer</h3>
          <input id="newHeaderTitle" placeholder="Header Title">
          <input id="newHeaderSubtitle" placeholder="Header Subtitle">
          <input id="newFooterText" placeholder="Footer Text">
          <button id="updateHeaderFooter">Update Header & Footer</button>
        </div>

        <div class="admin-panel-section">
          <h3>Quiz Schedule Settings</h3>
          <label>Quiz Start (datetime-local):</label>
          <input id="quizStartTime" type="datetime-local">
          <label>Quiz End (datetime-local):</label>
          <input id="quizEndTime" type="datetime-local">
          <button id="updateQuizSchedule">Update Quiz Schedule</button>
        </div>

        <!-- Upload Quiz HTML File Section -->
        <div class="admin-panel-section">
          <h3>Upload Quiz HTML File</h3>
          <input type="file" id="quizFile" accept=".html">
          <button id="uploadQuizBtn">Upload and Activate Quiz</button>
        </div>

        <!-- View Quiz Results -->
        <div class="admin-panel-section">
          <h3>Quiz Results</h3>
          <table>
            <thead>
              <tr>
                <th>Full Name</th>
                <th>Username</th>
                <th>Attempted</th>
                <th>Score</th>
                <th>Time Taken</th>
                <th>Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="resultsTable"></tbody>
          </table>
          <button id="refreshResultsBtn">Refresh Results</button>
        </div>
      `;
      document.body.insertBefore(adminContainer, document.getElementById("footerSection"));
      refreshAdminTable();
      refreshResultsTable();

      document.getElementById("addUserBtn").onclick = () => {
        const u = document.getElementById("newUser").value.trim();
        const p = document.getElementById("newPass").value.trim();
        const mode = document.getElementById("newMode").value;
        if (!u || !p) { alert("Enter both username and password."); return; }
        let arr = getUsers();
        arr.push({ u, p, mode, added: Date.now() });
        saveUsers(arr);
        refreshAdminTable();
        document.getElementById("newUser").value = "";
        document.getElementById("newPass").value = "";
      };

      document.getElementById("updateHeaderFooter").onclick = () => {
        const newTitle = document.getElementById("newHeaderTitle").value.trim();
        const newSubtitle = document.getElementById("newHeaderSubtitle").value.trim();
        const newFooter = document.getElementById("newFooterText").value.trim();
        if(newTitle) localStorage.setItem("headerTitle", newTitle);
        if(newSubtitle) localStorage.setItem("headerSubtitle", newSubtitle);
        if(newFooter) localStorage.setItem("footerText", newFooter);
        loadHeaderFooter();
        alert("Header and footer updated.");
      };

      document.getElementById("updateQuizSchedule").onclick = () => {
        const startTime = document.getElementById("quizStartTime").value;
        const endTime = document.getElementById("quizEndTime").value;
        if(startTime && endTime) {
          localStorage.setItem("quizStartTime", startTime);
          localStorage.setItem("quizEndTime", endTime);
          alert("Quiz schedule updated.");
        } else {
          alert("Please set both start and end times.");
        }
      };

      document.getElementById("uploadQuizBtn").onclick = () => {
        const fileInput = document.getElementById("quizFile");
        if(fileInput.files.length === 0) {
          alert("Please select an HTML file to upload.");
          return;
        }
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          let fileContent = e.target.result;
          if (!fileContent.toLowerCase().includes("<!doctype html>") &&
              !fileContent.toLowerCase().includes("<html")) {
            fileContent = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Uploaded Quiz</title>
</head>
<body>
${fileContent}
</body>
</html>`;
          }
          localStorage.setItem("uploadedQuizHTML", fileContent);
          alert("Quiz HTML uploaded, fixed (if necessary), and activated!");
        };
        reader.onerror = function(e) { alert("Error reading file."); };
        reader.readAsText(file);
      };

      document.getElementById("refreshResultsBtn").onclick = refreshResultsTable;
    }

    function refreshAdminTable() {
      const tbody = document.getElementById("userTable");
      tbody.innerHTML = "";
      getUsers().forEach((user, i) => {
        const tr = document.createElement("tr");
        tr.insertCell().innerText = user.u;
        tr.insertCell().innerText = user.p;
        tr.insertCell().innerText = user.mode === "single" ? "Singleâ€‘Device" : "Multiâ€‘Device";
        tr.insertCell().innerText = new Date(user.added).toLocaleString();
        const actionCell = tr.insertCell();
        const removeBtn = document.createElement("button");
        removeBtn.textContent = "Remove";
        removeBtn.onclick = () => { let arr = getUsers(); arr.splice(i, 1); saveUsers(arr); refreshAdminTable(); };
        actionCell.appendChild(removeBtn);
      });
    }

    function refreshResultsTable() {
      const tbody = document.getElementById("resultsTable");
      tbody.innerHTML = "";
      getResults().forEach((result, index) => {
        const tr = document.createElement("tr");
        tr.insertCell().innerText = result.fullName;
        tr.insertCell().innerText = result.username;
        tr.insertCell().innerText = result.attempted;
        tr.insertCell().innerText = result.score;
        tr.insertCell().innerText = result.timeTaken;
        tr.insertCell().innerText = result.date;
        const actionCell = tr.insertCell();
        const removeBtn = document.createElement("button");
        removeBtn.textContent = "Remove";
        removeBtn.onclick = () => { let results = getResults(); results.splice(index, 1); saveResults(results); refreshResultsTable(); };
        actionCell.appendChild(removeBtn);
      });
    }
  </script>
</body>
</html>
